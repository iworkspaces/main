<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ระบบสุ่มรางวัล Lucky Draw - ชมรมร้านยาสุราษฎร์ธานี</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://suratdrugstoreclub.netlify.app/assets/icon2.ico" type="image/x-icon">
  <style>
    /* ตั้งค่าพื้นฐานสำหรับ body */
    body {
      font-family: 'Sarabun', sans-serif; /* ใช้ฟอนต์ Sarabun */
      background-color: #E0F2F7; /* พื้นหลังสีฟ้าอ่อน */
      margin: 0;
      padding: 5px;
      display: flex;
      justify-content: center; /* จัดให้อยู่กึ่งกลางแนวนอน */
      align-items: flex-start; /* จัดให้อยู่ด้านบนในแนวตั้ง (เพื่อการเลื่อนที่ดีบนมือถือ) */
      min-height: 100vh; /* ความสูงขั้นต่ำเต็มหน้าจอ */
      box-sizing: border-box;
    }

    /* สไตล์สำหรับ container หลักของเนื้อหา */
    .container {
      max-width: 960px; /* ความกว้างสูงสุดของ container */
      width: 100%;
      margin: 5px auto; /* ระยะห่างจากด้านบนและกึ่งกลางอัตโนมัติ */
      background-color: #ffffff; /* พื้นหลังสีขาว */
      border-radius: 5px; /* ขอบโค้งมน */
      padding: 5px;
      box-shadow: 0 6px 5px rgba(0, 0, 0, 0.15); /* เงาของกล่อง */
      text-align: center; /* จัดเนื้อหาใน container ให้อยู่กึ่งกลาง */
    }

    /* สไตล์สำหรับรูปภาพ Header */
    .header-image {
      max-width: 90%; /* ทำให้รูปภาพไม่เกินความกว้างของ container */
      height: auto; /* รักษาอัตราส่วนของรูปภาพ */
      margin-bottom: 5px; /* เว้นระยะห่างด้านล่างรูปภาพ */
      border-radius: 5px; /* ทำให้ขอบรูปภาพโค้งมนเล็กน้อย */
      display: block; /* เพื่อให้สามารถจัดกึ่งกลางด้วย margin auto ได้ */
      margin-left: auto; /* จัดกึ่งกลางรูปภาพ */
      margin-right: auto; /* จัดกึ่งกลางรูปภาพ */
    }

    /* สไตล์สำหรับหัวเรื่อง h2 */
    h2 {
      text-align: center;
      color: #00567A; /* สีน้ำเงินเข้มสำหรับหัวเรื่อง */
      margin-bottom: 5px; /* เพิ่มระยะห่างด้านล่าง */
      font-size: 2.2em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
    }

    h3 {
      color: #00567A; /* สีน้ำเงินเข้ม */
      font-size: 1.8em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
      margin-top: 5px; /* เพิ่มระยะห่างด้านบน */
      margin-bottom: 5px; /* เพิ่มระยะห่างด้านล่าง */
    }

    label {
      font-weight: bold; /* ตัวหนา */
      display: block; /* แสดงเป็นบล็อกเต็มบรรทัด */
      margin-top: 5px; /* เพิ่มระยะห่างด้านบน */
      margin-bottom: 5px; /* เพิ่มระยะห่างด้านล่าง */
      font-size: 1.3em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
      color: #333;
    }

    /* สไตล์สำหรับ input field (หากมีการเพิ่มเข้ามาในอนาคต) */
    input[type="number"] {
      padding: 5px; /* เพิ่ม padding */
      width: calc(100% - 5px); /* คำนวณความกว้างเผื่อ padding */
      max-width: 350px; /* ความกว้างสูงสุด */
      margin-top: 5px;
      margin-bottom: 5px; /* เพิ่มระยะห่างด้านล่าง */
      border: 1px solid #90CAF9; /* เส้นขอบสีฟ้า */
      border-radius: 5px; /* ขอบโค้งมน */
      font-size: 1.4em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
      text-align: center; /* จัดข้อความใน input ให้อยู่กึ่งกลาง */
      box-sizing: border-box; /* ทำให้ padding ไม่เพิ่มขนาดรวม */
    }

    /* สไตล์สำหรับปุ่ม */
    button {
      background-color: #2196F3; /* สีฟ้าสำหรับปุ่ม */
      color: white; /* ตัวอักษรสีขาว */
      padding: 15px 5px; /* เพิ่ม padding */
      border: none; /* ไม่มีเส้นขอบ */
      border-radius: 5px; /* ขอบโค้งมน */
      cursor: pointer; /* เปลี่ยน cursor เป็น pointer เมื่อชี้ */
      font-size: 1.4em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
      font-weight: bold; /* ตัวหนา */
      transition: background-color 0.3s ease; /* เอฟเฟกต์เปลี่ยนสีพื้นหลังอย่างนุ่มนวล */
      display: inline-block; /* แสดงผลแบบ inline-block เพื่อให้จัดกึ่งกลางได้ */
      margin-top: 15px; /* เพิ่มระยะห่างด้านบน */
      margin-bottom: 15px; /* เพิ่มระยะห่างด้านล่างปุ่ม */
    }

    button:hover {
      background-color: #1976D2; /* สีน้ำเงินเข้มขึ้นเมื่อเมาส์ชี้ */
    }

    /* สไตล์สำหรับปุ่มปลดล็อก */
    button.unlock-btn {
        background-color: #FFC107; /* สีเหลือง */
        color: #333;
        margin-top: 5px; /* เพิ่มระยะห่างจากปุ่มอื่นๆ */
    }

    button.unlock-btn:hover {
        background-color: #FFA000; /* สีเหลืองเข้มขึ้น */
    }

    /* สไตล์สำหรับรายการรางวัล, ผลลัพธ์, และรายการผู้ไม่ได้ลงทะเบียน */
    #prizeList, #results, #nonRegisteredList {
      margin-top: 40px; /* เพิ่มระยะห่างด้านบน */
      text-align: left; /* จัดข้อความในส่วนนี้ให้อยู่กึ่งกลาง */
      padding: 5px 5px; /* เพิ่ม padding */
      background-color: #F7FBFE; /* พื้นหลังสีฟ้าอ่อนมาก */
      border-radius: 5px; /* ขอบโค้งมน */
      box-shadow: 0 4px 5px rgba(0,0,0,0.08); /* เพิ่มเงา */
    }

    ul {
      list-style-type: none;
      padding: 0;
      text-align: left; /* จัดรายการให้อยู่ชิดซ้ายภายใน ul */
      max-width: 600px; /* จำกัดความกว้างของรายการ */
      margin: 0 auto; /* จัดกึ่งกลาง ul */
    }

    li {
      margin-bottom: 5px; /* เพิ่มระยะห่าง */
      font-size: 1.2em; /* ขนาดฟอนต์ที่ใหญ่ขึ้น */
      color: #555;
    }

    /* สไตล์สำหรับผลการสุ่มรางวัล (กลับไปเป็นข้อความธรรมดา) */
    .prize-result-block {
      margin-bottom: 5px; /* ระยะห่างระหว่างแต่ละชุดรางวัล */
      text-align: left; /* จัดข้อความชิดซ้าย */
    }

    .prize-result-block h4 {
      background-color: #BBDEFB; /* สีฟ้าอ่อน */
      color: #00567A; /* สีน้ำเงินเข้ม */
      padding: 5px 5px; /* Padding */
      margin: 0 0 5px 0; /* Margin ด้านล่าง */
      font-size: 1.5em; /* ขนาดฟอนต์ใหญ่ขึ้น */
      border-radius: 5px; /* ขอบมนเล็กน้อย */
      display: inline-block; /* ทำให้ h4 กินพื้นที่เท่าเนื้อหา */
      text-align: center; /* จัดข้อความใน h4 ให้อยู่กึ่งกลาง */
    }

    .prize-result-block p {
      font-size: 1.6em; /* **ขนาดฟอนต์ของ ID ใหญ่ขึ้น** */
      color: #333;
      line-height: 1.3; /* **ระยะห่างบรรทัดกระชับขึ้น** */
      word-break: break-all; /* หาก ID ยาวมากให้ขึ้นบรรทัดใหม่ได้ */
    }

    /* สไตล์สำหรับตารางผู้เข้าร่วมที่ไม่ได้ลงทะเบียน (ทำให้กระชับขึ้น) */
    #nonRegisteredList table {
      width: 100%; /* เต็มความกว้างของ container */
      border-collapse: collapse; /* ยุบเส้นขอบเซลล์ */
      margin-top: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* เงาเบาลง */
      border-radius: 5px; /* ขอบมนเล็กน้อย */
      overflow: hidden; /* เพื่อให้ border-radius ทำงานกับเนื้อหาได้ */
    }

    #nonRegisteredList th, #nonRegisteredList td {
      padding: 5px 5px; /* **ลด padding เพื่อให้กระชับขึ้น** */
      text-align: center;
      border: 1px solid #E0E0E0;
      font-size: 1.1em; /* **ขนาดฟอนต์กระชับขึ้น** */
    }

    #nonRegisteredList th {
      background-color: #90CAF9; /* สีฟ้ากลางๆ */
      color: #FFFFFF; /* ตัวอักษรสีขาว */
      font-weight: bold;
    }

    #nonRegisteredList tr:nth-child(even) {
      background-color: #E3F2FD; /* สีฟ้าอ่อนกว่าสำหรับแถวคู่ */
    }

    #nonRegisteredList tr:hover {
      background-color: #BBDEFB; /* สีฟ้าอ่อนเมื่อเมาส์วางบนแถว */
    }

    /* Media Queries สำหรับ Responsive Design (สำหรับหน้าจอขนาดเล็กกว่า 600px) */
    @media screen and (max-width: 600px) {
      body {
        padding: 5px;
      }

      .container {
        padding: 5px 5px;
        margin: 5px auto;
      }

      h2 {
        font-size: 1.8em;
      }

      h3 {
        font-size: 1.5em;
      }

      label, input[type="number"], button {
        font-size: 1.1em;
        padding: 5px 5px;
      }

      input[type="number"] {
        padding: 5px;
      }

      .prize-result-block h4 {
        font-size: 1.3em;
        padding: 5px 5px;
      }

      .prize-result-block p {
        font-size: 1.4em; /* **ปรับฟอนต์ของ ID สำหรับมือถือ** */
        line-height: 1.3; /* **ปรับระยะห่างบรรทัดสำหรับมือถือ** */
      }

      #nonRegisteredList th, #nonRegisteredList td {
        padding: 5px 5px; /* **ลด padding ในตารางบนมือถือให้กระชับขึ้นไปอีก** */
        font-size: 0.9em;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <img src="https://suratdrugstoreclub.netlify.app/assets/header2.jpg" alt="Lucky Draw Header" class="header-image">

    <h2>ระบบสุ่มรางวัล Lucky Draw</h2>
    <h2>Annual Meeting | ชมรมร้านยาสุราษฎร์ธานี</h2>

    <button onclick="generatePrizes()">โหลดข้อมูลผู้เข้าร่วม & แสดงรายการรางวัล</button>
    <div id="prizeList"></div>

    <button onclick="drawPrizes()" style="display:none;" id="drawBtn">สุ่มรางวัล</button>
    <div id="results"></div>

    <button onclick="sendToGoogleSheet()" style="display:none;" id="sendToSheetBtn">ส่งผลรางวัลไป Google Sheet</button>
    
    <!-- ปุ่มสำหรับปลดล็อกการสุ่มใหม่ -->
    <button onclick="promptForUnlock()" class="unlock-btn" style="display:none;" id="unlockBtn">ปลดล็อกการสุ่มใหม่</button>

    <div id="nonRegisteredList"></div>

    <script>
      const prizes = [
        { set: 1, name: "ถุงหิ้วขาว", amount: 30 },
        { set: 2, name: "ร่ม", amount: 60 },
        { set: 3, name: "กระเป๋าเก็บสายชาร์จ", amount: 30 },
        { set: 4, name: "ลิ้นชักเล็ก", amount: 30 },
        { set: 5, name: "หมอนงีบ", amount: 30 },
        { set: 6, name: "พรมเช็ดเท้า", amount: 30 },
        { set: 7, name: "ตะกร้ากระจูด", amount: 30 },
        { set: 8, name: "ผ้าขนหนู", amount: 30 },
        { set: 9, name: "แก้วน้ำ", amount: "remaining" } // จะถูกคำนวณใน generatePrizes
      ];

      // allParticipantDetails จะเก็บข้อมูลดิบจาก Google Sheet (E-Ticket ID, Name, Shop, Status, PrizeSet, Prize, ReceiptStatus)
      let allParticipantDetails = []; 
      // registeredParticipantsForDraw จะเก็บ ID ที่ใช้สุ่ม (คือค่า E-Ticket ID จากคอลัมน์ A เช่น "001")
      let registeredParticipantsForDraw = []; 
      // drawResults จะเก็บผลการสุ่ม (E-Ticket ID ที่ได้รางวัล)
      let drawResults = []; 

      // URL สำหรับ Apps Script Web App (ใช้ URL โดยตรงจาก Netlify.toml ที่คุณให้มา)
      const getParticipantsAppsScriptUrl = 'https://script.google.com/macros/s/AKfycby6YoKG-A2fOSNCcGkL27BKG4q2b1lV3M4m78borB5_BjOpzR4eowivhAp4TIoJTqUIIg/exec'; 
      const updatePrizeResultsAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbwrwn9QTYF90uT-FCE8vQZPnNl_6Fj-LomgvVlBupKyiRv6-rK4lOhNHd3aPvS7SuaWEw/exec'; 

      // รหัสผ่านสำหรับปลดล็อก (ควรเปลี่ยนเป็นรหัสผ่านที่ซับซ้อนกว่านี้ในระบบจริง)
      const ulp = "drug@srt"; 

      async function generatePrizes() {
        try {
          document.getElementById("prizeList").innerHTML = `<p>กำลังโหลดข้อมูลผู้เข้าร่วมงานจาก Google Sheet...</p>`;
          document.getElementById("drawBtn").style.display = "none";
          document.getElementById("sendToSheetBtn").style.display = "none";
          document.getElementById("unlockBtn").style.display = "none"; // ซ่อนปุ่มปลดล็อกตอนโหลดข้อมูล
          document.getElementById("results").innerHTML = ''; 
          document.getElementById("nonRegisteredList").innerHTML = '';

          const response = await fetch(getParticipantsAppsScriptUrl);
          const contentType = response.headers.get("content-type");
          if (!response.ok || !contentType || !contentType.includes("application/json")) {
              const textResponse = await response.text();
              console.error("Server did not return JSON or HTTP error for doGet. Response:", textResponse);
              throw new Error(`Failed to load participants: HTTP ${response.status} or invalid response format. Raw response: ${textResponse.substring(0, 200)}...`);
          }
          
          const result = await response.json();
          console.log("ผลลัพธ์จาก doGet():", result); 

          const data = result;

          if (data.status === "success" && Array.isArray(data.allParticipants) && data.allParticipants.length) {
            allParticipantDetails = data.allParticipants;
            
            // กรองผู้เข้าร่วมที่ 'status' เป็น 'registered' และมี 'id' (จากคอลัมน์ A) ไม่เป็น null/undefined/empty string
            registeredParticipantsForDraw = allParticipantDetails
              .filter(p => p.status?.toLowerCase().trim() === "registered" && 
                               (p.id !== null && p.id !== undefined && String(p.id).trim() !== '')) 
              .map(p => String(p.id).trim()); // *** สำคัญ: เก็บ E-Ticket ID ที่ใช้สุ่ม (เช่น "001") ***
            
            console.log("Registered Participants (E-Ticket IDs for draw):", registeredParticipantsForDraw); 
            if (registeredParticipantsForDraw.length > 0) {
              console.log("First 5 registered E-Ticket IDs:", registeredParticipantsForDraw.slice(0, 5)); 
            } else {
              console.log("No registered E-Ticket IDs found for draw. Check sheet data and 'status' column.");
            }

          } else {
            throw new Error("ไม่มีข้อมูลผู้เข้าร่วมที่ลงทะเบียน หรือข้อมูลไม่ถูกต้องจาก Google Sheet.");
          }
        } catch (error) {
          alert("ไม่สามารถโหลดข้อมูลได้: " + error.message);
          console.error("Error loading participants:", error);
          document.getElementById("prizeList").innerHTML = `<p style="color: red;">เกิดข้อผิดพลาดในการโหลดข้อมูล: ${error.message}</p>`;
          return;
        }

        const totalRegistered = registeredParticipantsForDraw.length;
        if (!totalRegistered) {
          alert("ไม่พบผู้เข้าร่วมที่ลงทะเบียนที่ผ่านการคัดกรอง. โปรดตรวจสอบข้อมูลใน Google Sheet.");
          document.getElementById("prizeList").innerHTML = `<p>ไม่พบผู้เข้าร่วมที่ลงทะเบียน</p>`;
          return;
        }

        // คำนวณจำนวนรางวัล "แก้วน้ำ" (ชุดที่ 9)
        const usedPrizesCount = prizes.slice(0, 8).reduce((sum, p) => sum + p.amount, 0);
        const remainingPrizes = Math.max(0, totalRegistered - usedPrizesCount);
        prizes[8].amount = remainingPrizes; // อัปเดตจำนวนรางวัลสำหรับชุดที่ 9

        let html = `<h3>รายการของรางวัล (ลงทะเบียน ${totalRegistered} คน):</h3><ul>`;
        prizes.forEach(p => {
          html += `<li>ชุดที่ ${p.set} - ${p.name} จำนวน: ${p.amount} รางวัล</li>`;
        });
        html += `</ul>`;
        document.getElementById("prizeList").innerHTML = html;
        document.getElementById("drawBtn").style.display = "inline-block";
        displayNonRegisteredParticipants();
      }

      function drawPrizes() {
        if (!registeredParticipantsForDraw.length) {
            alert("กรุณาโหลดข้อมูลผู้เข้าร่วมก่อน");
            return;
        }

        let pool = [...registeredParticipantsForDraw]; // สร้าง pool จาก E-Ticket ID ที่ลงทะเบียน
        drawResults = []; // เคลียร์ผลลัพธ์เก่า

        let html = `<h3>ผลการสุ่มรางวัล:</h3>`;
        prizes.forEach(p => {
          let selectedIds = []; // เก็บ E-Ticket ID ที่ถูกสุ่ม
          for (let i = 0; i < p.amount; i++) {
            if (!pool.length) {
              console.warn(`Pool exhausted for prize set ${p.set} - ${p.name}. Only ${selectedIds.length} winners drawn.`);
              break; // ถ้าไม่มีผู้เข้าร่วมเหลือใน pool แล้ว ก็หยุด
            }
            const index = Math.floor(Math.random() * pool.length);
            const selectedId = pool.splice(index, 1)[0]; // สุ่มเลือก E-Ticket ID และนำออกจาก pool
            selectedIds.push(selectedId); 
          }
          // ค้นหาข้อมูลผู้เข้าร่วมจาก E-Ticket ID เพื่อแสดงผล
          const displayWinners = selectedIds.map(id => {
              const participant = allParticipantDetails.find(p => String(p.id).trim() === id);
              return participant ? String(participant.id).trim().padStart(3, '0') : id; // แสดง E-Ticket ID
          });
          drawResults.push({ set: p.set, name: p.name, winners: selectedIds, displayWinners: displayWinners }); // เก็บ E-Ticket ID ใน winners และ displayWinners
        });

        console.log("Raw drawResults (E-Ticket IDs and Prize Sets):", drawResults); 

        drawResults.forEach(prizeSet => {
          html += `<div class="prize-result-block">
                     <h4>ชุดที่ ${prizeSet.set} - ${prizeSet.name}</h4>
                     <p>${prizeSet.displayWinners.join(', ') || 'ยังไม่มีผู้โชคดี'}</p>
                   </div>`;
        });

        document.getElementById("results").innerHTML = html;
        document.getElementById("sendToSheetBtn").style.display = "inline-block";
      }

      async function sendToGoogleSheet() {
        if (!drawResults.length) {
            alert("กรุณาสุ่มรางวัลก่อน");
            return;
        }

        // สร้าง array ของ object ที่มี id (คือ E-Ticket ID) และ prizeSet
        // ใช้ prizeSet.winners (ซึ่งเก็บ E-Ticket ID)
        const updatesToSend = drawResults.flatMap(prizeSet =>
          prizeSet.winners.map(winnerId => ({ id: winnerId, prizeSet: prizeSet.set })) // เปลี่ยน eticketId เป็น id
        );

        console.log("ส่งข้อมูลไปยัง Google Sheet (updatesToSend):", JSON.stringify({ updates: updatesToSend }, null, 2)); 

        try {
          const response = await fetch(updatePrizeResultsAppsScriptUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ updates: updatesToSend }), // ส่ง updates array ภายใต้ key 'updates'
            mode: 'no-cors' // *** IMPORTANT: Using no-cors mode to bypass CORS issues, but cannot read response directly ***
          });

          // เมื่อใช้ 'no-cors', response.ok จะเป็น true เสมอ และไม่สามารถอ่าน response body ได้
          // ดังนั้นเราจะเช็คแค่ว่า fetch ไม่ได้ throw error ก็พอ
          if (response) {
              console.log("Request ถูกส่งไปแล้ว (ในโหมด no-cors). ไม่สามารถอ่านผลลัพธ์โดยตรงจาก Apps Script ได้");
              alert("บันทึกข้อมูลชุดรางวัลสำเร็จ!"); // แสดงข้อความแจ้งเตือนว่าส่งสำเร็จ
              lockDrawButtons(); // ล็อกปุ่มหลังจากบันทึกสำเร็จ
          } else {
              console.error("เกิดข้อผิดพลาดที่ไม่คาดคิดในการส่ง Request (ในโหมด no-cors):", response);
              alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล (โปรดตรวจสอบ Console และ Apps Script Executions)");
          }

        } catch (error) {
          console.error("ส่งข้อมูลผิดพลาด (จาก fetch API):", error);
          alert("ส่งข้อมูลผิดพลาด: " + error.message);
        }
      }

      function displayNonRegisteredParticipants() {
        // กรองผู้เข้าร่วมที่ไม่ได้อยู่ใน registeredParticipantsForDraw
        const nonRegistered = allParticipantDetails.filter(p =>
          // ตรวจสอบ id (column A) ก่อน แล้วค่อยใช้ในการเปรียบเทียบ
          (p.id !== null && p.id !== undefined && String(p.id).trim() !== '') && !registeredParticipantsForDraw.includes(String(p.id).trim()) 
        );

        let html = `<h3>ผู้เข้าร่วมที่ไม่ได้ลงทะเบียน:</h3>`;
        if (nonRegistered.length) {
          html += `<table><thead><tr><th>E-TICKET ID (A)</th><th>ชื่อ-สกุล</th><th>ชื่อร้าน</th></tr></thead><tbody>`;
          nonRegistered.forEach(p => {
            // แสดงผล E-TICKET ID (column A)
            const displayETicketId = (p.id !== null && p.id !== undefined && String(p.id).trim() !== '') ? String(p.id).trim().padStart(3, '0') : '-'; 
            html += `<tr><td>${displayETicketId}</td><td>${p.name || '-'}</td><td>${p.shop || '-'}</td></tr>`;
          });
          html += `</tbody></table>`;
        } else {
          html += `<p>ไม่พบผู้เข้าร่วมที่ไม่ได้ลงทะเบียน.</p>`;
        }
        document.getElementById("nonRegisteredList").innerHTML = html;
      }

      // ฟังก์ชันสำหรับล็อกปุ่ม "สุ่มรางวัล" และ "ส่งผลรางวัลไป Google Sheet"
      function lockDrawButtons() {
          document.getElementById("drawBtn").disabled = true;
          document.getElementById("sendToSheetBtn").disabled = true;
          document.getElementById("drawBtn").style.opacity = "0.5";
          document.getElementById("sendToSheetBtn").style.opacity = "0.5";
          document.getElementById("unlockBtn").style.display = "inline-block"; // แสดงปุ่มปลดล็อก
      }

      // ฟังก์ชันสำหรับปลดล็อกปุ่ม "สุ่มรางวัล" และ "ส่งผลรางวัลไป Google Sheet"
      function unlockDrawButtons() {
          document.getElementById("drawBtn").disabled = false;
          document.getElementById("sendToSheetBtn").disabled = false;
          document.getElementById("drawBtn").style.opacity = "1";
          document.getElementById("sendToSheetBtn").style.opacity = "1";
          document.getElementById("unlockBtn").style.display = "none"; // ซ่อนปุ่มปลดล็อก
          // อาจจะรีเซ็ตผลลัพธ์การสุ่มเก่าด้วย
          drawResults = [];
          document.getElementById("results").innerHTML = '';
      }

      // ฟังก์ชันสำหรับเรียก prompt รหัสผ่าน
      function promptForUnlock() {
          const password = prompt("กรุณาใส่รหัสผ่านเพื่อปลดล็อก:");
          if (password === ulp) {
              unlockDrawButtons();
              alert("ปลดล็อกสำเร็จ!");
          } else {
              alert("รหัสผ่านไม่ถูกต้อง!");
          }
      }

      // ล็อกปุ่มเมื่อโหลดหน้าเว็บครั้งแรก (ถ้าต้องการให้เริ่มมาก็ล็อกเลย)
      // หรือคุณอาจจะเรียก lockDrawButtons() หลังจากที่โหลดข้อมูลผู้เข้าร่วมเสร็จสิ้น
      // หรือหลังจากที่สุ่มรางวัลครั้งแรกและบันทึกไปแล้ว
      // สำหรับตอนนี้ ผมจะให้มันทำงานหลังจากบันทึกข้อมูลไปแล้ว
      // แต่ถ้าต้องการให้เริ่มมาก็ล็อกเลย ให้เรียก lockDrawButtons() ที่นี่
      // lockDrawButtons(); // uncomment บรรทัดนี้ถ้าต้องการให้ปุ่มล็อกตั้งแต่แรก
    </script>
  </div>
</body>
</html>
